# üì° Telegram WatchDog Bot for DSF.Finance

> –ù–∞–¥—ë–∂–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö –≤ –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö API –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö DSF

---

## üîç –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º —Å–∫–æ—Ä–æ—Å—Ç–∏ (rate-limit safe)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Ç–æ–∫–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–µ
- ‚úÖ –†–µ–∂–∏–º –±–µ–∑ –ø–æ—Ç–æ–∫–æ–≤ (–µ—Å–ª–∏ TELEGRAM_THREAD_URL_ERRORS === 'none')
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ (deduplication —á–µ—Ä–µ–∑ hash + NodeCache)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ QUIET_MODE (–¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –≤ staging/dev —Å—Ä–µ–¥–µ)
- ‚úÖ –£—Å–µ—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–æ 4096 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Telegram API (429 Too Many Requests –∏ –¥—Ä.)

---

## üì¶ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```ts
import { sendMessageToChat, safeSendMessage } from './bots/telegramBotWatchDog.mjs';

await safeSendMessage(
  'error|contract|0xabc123',
  'üö® –û—à–∏–±–∫–∞ –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ 0xabc123: –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É–ª–∞',
  process.env.TELEGRAM_THREAD_CONTRACT_ERRORS
);
```

---

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è                    | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                         |
|-------------------------------|----------------------------------------------------|
| `TELEGRAM_BOT_TOKEN_WD`       | –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞                                |
| `TELEGRAM_SUPERGROUP_ID`      | ID Telegram-—Å—É–ø–µ—Ä–≥—Ä—É–ø–ø—ã                            |
| `TELEGRAM_THREAD_URL_ERRORS`  | ID –ø–æ—Ç–æ–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –æ—à–∏–±–æ–∫                  |
| `TELEGRAM_GLOBAL_RATE`        | –ú–∞–∫—Å–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ 10 —Å–µ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî 5)    |
| `QUIET_MODE`                  | –ï—Å–ª–∏ `true` ‚Äî –æ—Ç–∫–ª—é—á–∞–µ—Ç –ª—é–±—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram |

---

## üìú –ú–µ—Ç–æ–¥—ã

| –ú–µ—Ç–æ–¥                                     | –û–ø–∏—Å–∞–Ω–∏–µ                                               |
|-------------------------------------------|--------------------------------------------------------|
| `sendMessageToChat(message, threadId)`    | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–æ—Ç–æ–∫      |
| `safeSendMessage(key, message, threadId)` | –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É (–ø–æ —Å–º—ã—Å–ª–æ–≤–æ–º—É –∫–ª—é—á—É) |

---

## üõ° –ü—Ä–∏–º–µ—Ä—ã

### ‚ö†Ô∏è –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –ø–æ–≤—Ç–æ—Ä–æ–≤

```ts
await safeSendMessage(
  'proxy|url|timeout',
  '‚è≥ –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ API',
  '11666'
);
```

### ‚úÖ –û–±—ã—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞

```ts
await sendMessageToChat('üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram-–±–æ—Ç–∞');
```

---

## ‚è± –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–µ —á–∞—â–µ, —á–µ–º 1 —Ä–∞–∑ –≤ 1600 –º—Å
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `NodeCache` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–æ–≤—Ç–æ—Ä–æ–≤
- `messageQueue` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ –∏ –æ—à–∏–±–∫–∞—Ö API

---

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

**Andrei Averin**  
üõ° CTO @ DSF.Finance  
üì¨ [andreaverin24@gmail.com](mailto:andreaverin24@gmail.com)  
üîó [Telegram](https://t.me/andrey_blockchain) | [Twitter](https://twitter.com/andreaverin24)